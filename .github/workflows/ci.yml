name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate Project
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Check file structure
      run: |
        echo "Checking project structure..."
        test -f project.godot || (echo "project.godot not found" && exit 1)
        test -d scripts || (echo "scripts directory not found" && exit 1)
        test -d maps || (echo "maps directory not found" && exit 1)
        test -d docs || (echo "docs directory not found" && exit 1)
        test -d tests || (echo "tests directory not found" && exit 1)
        echo "✓ Project structure valid"
    
    - name: Validate JSON files
      run: |
        echo "Validating JSON files..."
        for file in maps/*.json; do
          if [ -f "$file" ]; then
            echo "Checking $file..."
            python3 -m json.tool "$file" > /dev/null || (echo "Invalid JSON: $file" && exit 1)
          fi
        done
        echo "✓ All JSON files valid"
    
    - name: Check GDScript syntax
      run: |
        echo "Checking GDScript files exist..."
        find scripts -name "*.gd" -type f | while read file; do
          echo "  Found: $file"
        done
        echo "✓ GDScript files present"
    
    - name: Verify documentation
      run: |
        echo "Checking documentation..."
        test -f README.md || (echo "README.md not found" && exit 1)
        test -f docs/architecture.md || (echo "architecture.md not found" && exit 1)
        test -f docs/map_format.md || (echo "map_format.md not found" && exit 1)
        test -f docs/agents.md || (echo "agents.md not found" && exit 1)
        test -f docs/replay.md || (echo "replay.md not found" && exit 1)
        echo "✓ Documentation complete"
    
    - name: Check license
      run: |
        echo "Checking license..."
        test -f LICENSE || (echo "LICENSE not found" && exit 1)
        grep -q "MIT License" LICENSE || (echo "Not MIT license" && exit 1)
        echo "✓ MIT License present"
    
    - name: Summary
      run: |
        echo ""
        echo "========================================="
        echo "  CI Validation Complete"
        echo "========================================="
        echo "All checks passed successfully!"
        echo ""
        echo "Project: RadiantX - Tactical FPS Coach Sim"
        echo "Status: ✓ Ready for development"
        echo "========================================="
